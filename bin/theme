#!/usr/bin/env bash

_check() {
    command -v "$1" > /dev/null
}

_display_background() {
    case "$1" in
        light)
            feh --no-fehbg --bg-scale $HOME/Pictures/Wallpapers/tim-zankert-1YFt4rpHKp0-unsplash.jpg
            ;;
        dark)
            feh --no-fehbg --bg-scale $HOME/Pictures/Wallpapers/vox-machina.jpg --bg-scale $HOME/Pictures/Wallpapers/mighty-nein.jpg
            ;;
    esac
}

_set_wallpaper() {
    hour=$(timedatectl status | awk '/Local/ {print $5}' | cut -d':' -f1)
    if [[ hour -lt 17 && hour -gt 10 ]]; then
        if [[ $current != "light" ]]; then
            _display_background light
        fi
        echo "light"
    else
        if [[ $current != "dark" ]]; then
            _display_background dark
        fi
        echo "dark"
    fi
}

_toggle_wallpaper() {
    case "$1" in
	light)
	    _display_background dark
	    echo "dark"
	    ;;
	dark)
	    _display_background light
	    echo "light"
	    ;;
    esac
}

_set_emacs_theme() {
    if _check emacsclient; then
	case "$1" in
	    light)
		local update=$(emacsclient --alternate-editor="" --eval "(load-theme 'modus-operandi)")
		echo ${update}
		;;
	    dark)
		local update=$(emacsclient --alternate-editor="" --eval "(load-theme 'modus-vivendi)")
		echo ${update}
		;;
	esac
    fi
}


case $1 in
    reset)
        current=$(_set_wallpaper)
	_set_emacs_theme $current
	echo $current > /tmp/theme
        ;;
    toggle)
        current=$(</tmp/theme)
        new=$(_toggle_wallpaper $current)
	_set_emacs_theme $new
        echo $new > /tmp/theme
        ;;
    *)
        echo "Please provide a valid argument (reset|toggle)"
esac


